/*
 * test_cosem_read_by_block.cpp
 *
 *  Created on: 3 nov. 2017
 *      Author: anthony
 */

#include "os_util.h"
#include "hdlc.h"
#include "csm_axdr_codec.h"
#include "csm_array.h"
#include "JsonWriter.h"
#include "JsonValue.h"
#include "AxdrPrinter.h"

#include "catch.hpp"
#include <iostream>
#include <cstdlib>
#include <cstring>
#include <sstream>
#include <bitset>

//const char profile_example[] = "008201F401020208090C07E0091C031111210000B4000408110221090C07E0091C031111210000B400020509060100010600FF060000000002020F00161B1100090C07D001010600000000000000020509060100020600FF060000000002020F00161B1100090C07D001010600000000000000020509060100030600FF060000000002020F00161D1100090C07D001010600000000000000020509060100040600FF060000000002020F00161D1100090C07D001010600000000000000020509060100050600FF060000000002020F00161D1100090C07D001010600000000000000020509060100080600FF060000000002020F00161D1100090C07D001010600000000000000020509060100090600FF060000000002020F00161C1100090C07D0010106000000000000000205090601000A0600FF060000000002020F00161C1100090C07D001010600000000000000020509060100010601FF060000000002020F00161B1100090C07D001010600000000000000020509060100020601FF060000000002020F00161B1100090C07D001010600000000000000020509060100030601FF060000000002020F00161D1100090C07D001010600000000000000020509060100040601FF060000000002020F00161D1100090C07D001010600000000000000020509060100050601FF060000000002020F00008201F4161D1100090C07D001010600000000000000020509060100080601FF060000000002020F00161D1100090C07D001010600000000000000020509060100090601FF060000000002020F00161C1100090C07D0010106000000000000000205090601000A0601FF060000000002020F00161C1100090C07D001010600000000000000020509060100010602FF060000000002020F00161B1100090C07D001010600000000000000020509060100020602FF060000000002020F00161B1100090C07D001010600000000000000020509060100030602FF060000000002020F00161D1100090C07D001010600000000000000020509060100040602FF060000000002020F00161D1100090C07D001010600000000000000020509060100050602FF060000000002020F00161D1100090C07D001010600000000000000020509060100080602FF060000000002020F00161D1100090C07D001010600000000000000020509060100090602FF060000000002020F00161C1100090C07D0010106000000000000000205090601000A0602FF060000000002020F00161C1100090C07D001010600000000000000020509060100010603FF060000000002020F00161B1100090C07D001010600000000000000020509060100020603FF060000000002020F00161B1100090C07D00101060000000000000002008201F40509060100030603FF060000000002020F00161D1100090C07D001010600000000000000020509060100040603FF060000000002020F00161D1100090C07D001010600000000000000020509060100050603FF060000000002020F00161D1100090C07D001010600000000000000020509060100080603FF060000000002020F00161D1100090C07D001010600000000000000020509060100090603FF060000000002020F00161C1100090C07D0010106000000000000000205090601000A0603FF060000000002020F00161C1100090C07D0010106000000000000000221090C07E0091C031111210000B400020309060100010200FF15000000000000000002020F00161B020309060100020200FF15000000000000000002020F00161B020309060100030200FF15000000000000000002020F00161D020309060100040200FF15000000000000000002020F00161D020309060100050200FF15000000000000000002020F00161D020309060100080200FF15000000000000000002020F00161D020309060100090200FF15000000000000000002020F00161C0203090601000A0200FF15000000000000000002020F00161C020309060100010201FF15000000000000000002020F00161B020309060100020201FF15000000000000000002020F00161B020309060100030201FF150000008201F400000000000002020F00161D020309060100040201FF15000000000000000002020F00161D020309060100050201FF15000000000000000002020F00161D020309060100080201FF15000000000000000002020F00161D020309060100090201FF15000000000000000002020F00161C0203090601000A0201FF15000000000000000002020F00161C020309060100010202FF15000000000000000002020F00161B020309060100020202FF15000000000000000002020F00161B020309060100030202FF15000000000000000002020F00161D020309060100040202FF15000000000000000002020F00161D020309060100050202FF15000000000000000002020F00161D020309060100080202FF15000000000000000002020F00161D020309060100090202FF15000000000000000002020F00161C0203090601000A0202FF15000000000000000002020F00161C020309060100010203FF15000000000000000002020F00161B020309060100020203FF15000000000000000002020F00161B020309060100030203FF15000000000000000002020F00161D020309060100040203FF15000000000000000002020F00161D020309060100050203FF15000000000000000002020F00161D020309060100080203FF15000000000000000002020F00161D020309060100090203FF150000008201F400000000000002020F00161C0203090601000A0203FF15000000000000000002020F00161C0247090C07E0091C031111210000B400040801020309060100010800FF15000000000000000002020F00161E020309060100020800FF15000000000000000002020F00161E020309060100030800FF15000000000000000002020F001620020309060100040800FF15000000000000000002020F001620020309060100050800FF15000000000000000002020F001620020309060100060800FF15000000000000000002020F001620020309060100070800FF15000000000000000002020F001620020309060100080800FF15000000000000000002020F001620020309060100090800FF15000000000000000002020F00161F0203090601000A0800FF15000000000000000002020F00161F0203090601000F0800FF15000000000000000002020F00161E0203090601000D0000FF06000003E802020FFD16FF020309060100150800FF15000000000000000002020F00161E020309060100160800FF15000000000000000002020F00161E020309060100170800FF15000000000000000002020F001620020309060100180800FF15000000000000000002020F001620020309060100190800FF15000000000000000002020F0016200203090601001A0800FF15000000000000000002020F00008201F416200203090601001B0800FF15000000000000000002020F0016200203090601001C0800FF15000000000000000002020F0016200203090601001D0800FF15000000000000000002020F00161F0203090601001E0800FF15000000000000000002020F00161F020309060100290800FF15000000000000000002020F00161E0203090601002A0800FF15000000000000000002020F00161E0203090601002B0800FF15000000000000000002020F0016200203090601002C0800FF15000000000000000002020F0016200203090601002D0800FF15000000000000000002020F0016200203090601002E0800FF15000000000000000002020F0016200203090601002F0800FF15000000000000000002020F001620020309060100300800FF15000000000000000002020F001620020309060100310800FF15000000000000000002020F00161F020309060100320800FF15000000000000000002020F00161F0203090601003D0800FF15000000000000000002020F00161E0203090601003E0800FF15000000000000000002020F00161E0203090601003F0800FF15000000000000000002020F001620020309060100400800FF15000000000000000002020F001620020309060100410800FF15000000000000000002020F001620020309060100420800FF15000000000000000002020F00008201F41620020309060100430800FF15000000000000000002020F001620020309060100440800FF15000000000000000002020F001620020309060100450800FF15000000000000000002020F00161F020309060100460800FF15000000000000000002020F00161F020309060100010801FF15000000000000000002020F00161E020309060100020801FF15000000000000000002020F00161E020309060100030801FF15000000000000000002020F001620020309060100040801FF15000000000000000002020F001620020309060100050801FF15000000000000000002020F001620020309060100080801FF15000000000000000002020F001620020309060100090801FF15000000000000000002020F00161F0203090601000A0801FF15000000000000000002020F00161F0203090601000D0001FF060000000002020FFD16FF020309060100010802FF15000000000000000002020F00161E020309060100020802FF15000000000000000002020F00161E020309060100030802FF15000000000000000002020F001620020309060100040802FF15000000000000000002020F001620020309060100050802FF15000000000000000002020F001620020309060100080802FF15000000000000000002020F001620020309060100090802FF15000000000000000002020F00161F020300820154090601000A0802FF15000000000000000002020F00161F0203090601000D0002FF06000003E802020FFD16FF020309060100010803FF15000000000000000002020F00161E020309060100020803FF15000000000000000002020F00161E020309060100030803FF15000000000000000002020F001620020309060100040803FF15000000000000000002020F001620020309060100050803FF15000000000000000002020F001620020309060100080803FF15000000000000000002020F001620020309060100090803FF15000000000000000002020F00161F0203090601000A0803FF15000000000000000002020F00161F0203090601000D0003FF060000000002020FFD16FF020309060100010900FF15000000000000000002020F00161E020309060100030900FF15000000000000000002020F001620020309060100090900FF15000000000000000002020F00161F008201F40208090C07E00A04020B1D080000B4000408130221090C07E00A04020B1D080000B400020509060100010600FF060000000102020F00161B1100090C07E0091C03111129008000FF020509060100020600FF060000000002020F00161B1100090C07E0091C031111210000B400020509060100030600FF060000000202020F00161D1100090C07E0091C03111129008000FF020509060100040600FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100050600FF060000000202020F00161D1100090C07E0091C03111129008000FF020509060100080600FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100090600FF060000000202020F00161C1100090C07E0091C03111129008000FF0205090601000A0600FF060000000002020F00161C1100090C07E0091C031111210000B400020509060100010601FF060000000002020F00161B1100090C07E0091C031111210000B400020509060100020601FF060000000002020F00161B1100090C07E0091C031111210000B400020509060100030601FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100040601FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100050601FF060000000002020F00161D008201F41100090C07E0091C031111210000B400020509060100080601FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100090601FF060000000002020F00161C1100090C07E0091C031111210000B4000205090601000A0601FF060000000002020F00161C1100090C07E0091C031111210000B400020509060100010602FF060000000102020F00161B1100090C07E0091C03111129008000FF020509060100020602FF060000000002020F00161B1100090C07E0091C031111210000B400020509060100030602FF060000000202020F00161D1100090C07E0091C03111129008000FF020509060100040602FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100050602FF060000000202020F00161D1100090C07E0091C03111129008000FF020509060100080602FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100090602FF060000000202020F00161C1100090C07E0091C03111129008000FF0205090601000A0602FF060000000002020F00161C1100090C07E0091C031111210000B400020509060100010603FF060000000002020F00161B1100090C07E0091C031111210000B400020509060100020603FF060000000002020F00161B1100090C07E0091C031111210000B400020509008201F4060100030603FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100040603FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100050603FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100080603FF060000000002020F00161D1100090C07E0091C031111210000B400020509060100090603FF060000000002020F00161C1100090C07E0091C031111210000B4000205090601000A0603FF060000000002020F00161C1100090C07E0091C031111210000B4000221090C07E00A04020B1D080000B400020309060100010200FF15000000000000000102020F00161B020309060100020200FF15000000000000000002020F00161B020309060100030200FF15000000000000000202020F00161D020309060100040200FF15000000000000000002020F00161D020309060100050200FF15000000000000000202020F00161D020309060100080200FF15000000000000000002020F00161D020309060100090200FF15000000000000000202020F00161C0203090601000A0200FF15000000000000000002020F00161C020309060100010201FF15000000000000000002020F00161B020309060100020201FF15000000000000000002020F00161B020309060100030201FF1500000000008201F40000000002020F00161D020309060100040201FF15000000000000000002020F00161D020309060100050201FF15000000000000000002020F00161D020309060100080201FF15000000000000000002020F00161D020309060100090201FF15000000000000000002020F00161C0203090601000A0201FF15000000000000000002020F00161C020309060100010202FF15000000000000000102020F00161B020309060100020202FF15000000000000000002020F00161B020309060100030202FF15000000000000000202020F00161D020309060100040202FF15000000000000000002020F00161D020309060100050202FF15000000000000000202020F00161D020309060100080202FF15000000000000000002020F00161D020309060100090202FF15000000000000000202020F00161C0203090601000A0202FF15000000000000000002020F00161C020309060100010203FF15000000000000000002020F00161B020309060100020203FF15000000000000000002020F00161B020309060100030203FF15000000000000000002020F00161D020309060100040203FF15000000000000000002020F00161D020309060100050203FF15000000000000000002020F00161D020309060100080203FF15000000000000000002020F00161D020309060100090203FF1500000000008201F40000000002020F00161C0203090601000A0203FF15000000000000000002020F00161C0247090C07E00A04020B1D080000B400040803020309060100010800FF15000000000000000102020F00161E020309060100020800FF15000000000000000002020F00161E020309060100030800FF15000000000000000102020F001620020309060100040800FF15000000000000000002020F001620020309060100050800FF15000000000000000102020F001620020309060100060800FF15000000000000000002020F001620020309060100070800FF15000000000000000002020F001620020309060100080800FF15000000000000000002020F001620020309060100090800FF15000000000000000102020F00161F0203090601000A0800FF15000000000000000002020F00161F0203090601000F0800FF15000000000000000102020F00161E0203090601000D0000FF060000039402020FFD16FF020309060100150800FF15000000000000000002020F00161E020309060100160800FF15000000000000000002020F00161E020309060100170800FF15000000000000000002020F001620020309060100180800FF15000000000000000002020F001620020309060100190800FF15000000000000000002020F0016200203090601001A0800FF15000000000000000002020F001620008201F40203090601001B0800FF15000000000000000002020F0016200203090601001C0800FF15000000000000000002020F0016200203090601001D0800FF15000000000000000002020F00161F0203090601001E0800FF15000000000000000002020F00161F020309060100290800FF15000000000000000002020F00161E0203090601002A0800FF15000000000000000002020F00161E0203090601002B0800FF15000000000000000002020F0016200203090601002C0800FF15000000000000000002020F0016200203090601002D0800FF15000000000000000002020F0016200203090601002E0800FF15000000000000000002020F0016200203090601002F0800FF15000000000000000002020F001620020309060100300800FF15000000000000000002020F001620020309060100310800FF15000000000000000002020F00161F020309060100320800FF15000000000000000002020F00161F0203090601003D0800FF15000000000000000002020F00161E0203090601003E0800FF15000000000000000002020F00161E0203090601003F0800FF15000000000000000002020F001620020309060100400800FF15000000000000000002020F001620020309060100410800FF15000000000000000002020F001620020309060100420800FF15000000000000000002020F001620008201F4020309060100430800FF15000000000000000002020F001620020309060100440800FF15000000000000000002020F001620020309060100450800FF15000000000000000002020F00161F020309060100460800FF15000000000000000002020F00161F020309060100010801FF15000000000000000002020F00161E020309060100020801FF15000000000000000002020F00161E020309060100030801FF15000000000000000002020F001620020309060100040801FF15000000000000000002020F001620020309060100050801FF15000000000000000002020F001620020309060100080801FF15000000000000000002020F001620020309060100090801FF15000000000000000002020F00161F0203090601000A0801FF15000000000000000002020F00161F0203090601000D0001FF060000000002020FFD16FF020309060100010802FF15000000000000000102020F00161E020309060100020802FF15000000000000000002020F00161E020309060100030802FF15000000000000000102020F001620020309060100040802FF15000000000000000002020F001620020309060100050802FF15000000000000000102020F001620020309060100080802FF15000000000000000002020F001620020309060100090802FF15000000000000000102020F00161F020309060082015201000A0802FF15000000000000000002020F00161F0203090601000D0002FF060000039402020FFD16FF020309060100010803FF15000000000000000002020F00161E020309060100020803FF15000000000000000002020F00161E020309060100030803FF15000000000000000002020F001620020309060100040803FF15000000000000000002020F001620020309060100050803FF15000000000000000002020F001620020309060100080803FF15000000000000000002020F001620020309060100090803FF15000000000000000002020F00161F0203090601000A0803FF15000000000000000002020F00161F0203090601000D0003FF060000000002020FFD16FF020309060100010900FF15000000000000000002020F00161E020309060100030900FF15000000000000000002020F001620020309060100090900FF15000000000000000002020F00161F";

//const char profile_example[] = "008201AC01120205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F0016040202114A1114090C07E10B0103020000FF8000FF01010206020309060101020800FF060051E52F02020F03161E020309060101010800FF060000B45C02020F03161E020309060101050800FF060000000802020F031620020309060101060800FF060001780E02020F031620020309060101070800FF0600001C9402020F031620020309060101080800FF060001D14902020F03162001010204020509060101010801FF060000B45C02020F03161E0000020509060101020801FF060051E52F02020F03161E0000020509060101030801FF060001781702020F0316200000020509060101040801FF060001EDDE02020F0316200000010102020906000062853DFF0105020312000E02020F03161C090C07E10A05FF112800FF8000FF020312000C02020F03161C090C07E10A16FF111E00FF8000FF020312000B02020F03161C090C07E10A1DFF111E00FF8000FF020312000B02020F03161C090C07E10A18FF111E00FF8000FF020312000B02020F03161C090C07E10A10FF111E00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001E02020F001604020211491114090C07E10A0100020000FF8000FF01010206020309060101020800FF060050F6DA02020F03161E020309060101010800FF060000B1DB02020F03161E020309060101050800FF060000000802020F031620020309060101060800FF060001741A02020F031620020309060101070800FF0600001C4B02020F031620020309060101080800FF060001CA9502020F03162001010204020509060101010801FF060000B1DB02020F03161E0000020509060101020801FF060050F6DA02020F03161E0000020509060101030801FF060001742302020F0316200000020509060101040801FF060001E6E002020F0316200000010102020906000062853DFF0105020312000F02020F03161C090C07E10907FF113200FF8000FF020312000E02020F03161C090C07E10902FF120A00FF8000FF020312000D02020F03161C090C07E10919FF113200FF8000FF020312000C02020F03161C090C07E10911FF120A00FF8000FF020312000C02020F03161C090C07E1090FFF120000FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F001604020211481114090C07E1090105020000FF8000FF01010206020309060101020800FF060050184502020F03161E020309060101010800FF060000AFA102020F03161E020309060101050800FF060000000802020F031620020309060101060800FF060001703302020F031620020309060101070800FF0600001C0802020F031620020309060101080800FF060001C4D502020F03162001010204020509060101010801FF060000AFA102020F03161E0000020509060101020801FF060050184502020F03161E0000020509060101030801FF060001703C02020F0316200000020509060101040801FF060001E0DE02020F0316200000010102020906000062853DFF0105020312000F02020F03161C090C07E10813FF120000FF8000FF020312000E02020F03161C090C07E10806FF121400FF8000FF020312000C02020F03161C090C07E1081CFF120A00FF8000FF020312000C02020F03161C090C07E10810FF112800FF8000FF020312000C02020F03161C090C07E1080FFF121400FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F001604020211471114090C07E1080102020000FF8000FF01010206020309060101020800FF06004EEC0A02020F03161E020309060101010800FF060000AD1A02020F03161E020309060101050800FF060000000802020F031620020309060101060800FF0600016A8102020F031620020309060101070800FF0600001BCE02020F031620020309060101080800FF060001BE8602020F03162001010204020509060101010801FF060000AD1A02020F03161E0000020509060101020801FF06004EEC0A02020F03161E0000020509060101030801FF0600016A8A02020F0316200000020509060101040801FF060001DA5502020F0316200000010102020906000062853DFF0105020312000F02020F03161C090C07E1070CFF120A00FF8000FF020312000C02020F03161C090C07E1071EFF121E00FF8000FF020312000C02020F03161C090C07E10714FF121E00FF8000FF020312000B02020F03161C090C07E1071FFF121E00FF8000FF020312000B02020F03161C090C07E1071CFF121E00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001E02020F001604020211461114090C07E1070106020000FF8000FF01010206020309060101020800FF06004DB4C402020F03161E020309060101010800FF060000AABB02020F03161E020309060101050800FF060000000802020F031620020309060101060800FF06000164AF02020F031620020309060101070800FF0600001B9A02020F031620020309060101080800FF060001B88002020F03162001010204020509060101010801FF060000AABB02020F03161E0000020509060101020801FF06004DB4C402020F03161E0000020509060101030801FF06000164B902020F0316200000020509060101040801FF060001D41B02020F0316200000010102020906000062853DFF0105020312000E02020F03161C090C07E1061DFF113200FF8000FF020312000E02020F03161C090C07E10602FF121400FF8000FF020312000D02020F03161C090C07E1061DFF120000FF8000FF020312000D02020F03161C090C07E1060CFF121400FF8000FF020312000C02020F03161C090C07E10614FF121400FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F001604020211451114090C07E1060104020000FF8000FF01010206020309060101020800FF06004C9C7E02020F03161E020309060101010800FF060000A88802020F03161E020309060101050800FF060000000802020F031620020309060101060800FF0600015F9C02020F031620020309060101070800FF0600001B6A02020F031620020309060101080800FF060001B2E802020F03162001010204020509060101010801FF060000A88802020F03161E0000020509060101020801FF06004C9C7E02020F03161E0000020509060101030801FF0600015FA502020F0316200000020509060101040801FF060001CE5202020F0316200000010102020906000062853DFF0105020312000C02020F03161C090C07E1050BFF120A00FF8000FF020312000C02020F03161C090C07E10507FF121400FF8000FF020312000C02020F03161C090C07E10506FF120A00FF8000FF020312000C02020F03161C090C07E10503FF120A00FF8000FF020312000B02020F03161C090C07E1051CFF121E00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001E02020F001604020211441114090C07E1050101020000FF8000FF01010206020309060101020800FF06004B739402020F03161E020309060101010800FF060000A62A02020F03161E020309060101050800FF060000000802020F031620020309060101060800FF0600015A3402020F031620020309060101070800FF0600001B3302020F031620020309060101080800FF060001ACD802020F03162001010204020509060101010801FF060000A62A02020F03161E0000020509060101020801FF06004B739402020F03161E0000020509060101030801FF0600015A3D02020F0316200000020509060101040801FF060001C80D02020F0316200000010102020906000062853DFF0105020312000E02020F03161C090C07E10412FF120A00FF8000FF020312000D02020F03161C090C07E10413FF120A00FF8000FF020312000D02020F03161C090C07E10409FF120A00FF8000FF020312000D02020F03161C090C07E10404FF120A00FF8000FF020312000D02020F03161C090C07E10402FF120A00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F001604020211431114090C07E1040106020000FF8000FF01010206020309060101020800FF06004A6FA902020F03161E020309060101010800FF060000A3F602020F03161E020309060101050800FF060000000802020F031620020309060101060800FF06000155A002020F031620020309060101070800FF0600001AF702020F031620020309060101080800FF060001A6B102020F03162001010204020509060101010801FF060000A3F602020F03161E0000020509060101020801FF06004A6FA902020F03161E0000020509060101030801FF06000155AA02020F0316200000020509060101040801FF060001C1AA02020F0316200000010102020906000062853DFF0105020312000E02020F03161C090C07E1031AFF120A00FF8000FF020312000E02020F03161C090C07E10313FF120A00FF8000FF020312000E02020F03161C090C07E10307FF120000FF8000FF020312000E02020F03161C090C07E10301FF120000FF8000FF020312000D02020F03161C090C07E10318FF120A00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001C02020F001604020211421114090C07E1030103020000FF8000FF01010206020309060101020800FF06004948D102020F03161E020309060101010800FF060000A1A502020F03161E020309060101050800FF060000000802020F031620020309060101060800FF0600014FFF02020F031620020309060101070800FF0600001AB002020F031620020309060101080800FF060001A00502020F03162001010204020509060101010801FF060000A1A502020F03161E0000020509060101020801FF06004948D102020F03161E0000020509060101030801FF060001500902020F0316200000020509060101040801FF060001BAB502020F0316200000010102020906000062853DFF0105020312000E02020F03161C090C07E10214FF120000FF8000FF020312000D02020F03161C090C07E1021CFF120000FF8000FF020312000C02020F03161C090C07E1020DFF120000FF8000FF020312000C02020F03161C090C07E10207FF120000FF8000FF020312000C02020F03161C090C07E10205FF120000FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F001604020211411114090C07E1020103020000FF8000FF01010206020309060101020800FF0600484A4002020F03161E020309060101010800FF0600009FB602020F03161E020309060101050800FF060000000802020F031620020309060101060800FF0600014B3202020F031620020309060101070800FF0600001A7902020F031620020309060101080800FF0600019A0702020F03162001010204020509060101010801FF0600009FB602020F03161E0000020509060101020801FF0600484A4002020F03161E0000020509060101030801FF0600014B3B02020F0316200000020509060101040801FF060001B48102020F0316200000010102020906000062853DFF0105020312000F02020F03161C090C07E10110FF112800FF8000FF020312000D02020F03161C090C07E10118FF112800FF8000FF020312000D02020F03161C090C07E10117FF113200FF8000FF020312000D02020F03161C090C07E10101FF112800FF8000FF020312000C02020F03161C090C07E10114FF113200FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F001604020211401114090C07E1010100020000FF8000FF01010206020309060101020800FF0600473ED202020F03161E020309060101010800FF0600009D9802020F03161E020309060101050800FF060000000802020F031620020309060101060800FF060001465F02020F031620020309060101070800FF0600001A3E02020F031620020309060101080800FF060001934202020F03162001010204020509060101010801FF0600009D9802020F03161E0000020509060101020801FF0600473ED202020F03161E0000020509060101030801FF060001466802020F0316200000020509060101040801FF060001AD8102020F0316200000010102020906000062853DFF0105020312000E02020F03161C090C07E00C01FF0F3200FF8000FF020312000D02020F03161C090C07E00C12FF111400FF8000FF020312000D02020F03161C090C07E00C0BFF111E00FF8000FF020312000D02020F03161C090C07E00C05FF111E00FF8000FF020312000D02020F03161C090C07E00C01FF110A00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001E02020F0016040202113F1114090C07E00C0104020000FF8000FF01010206020309060101020800FF06004650E702020F03161E020309060101010800FF0600009B7C02020F03161E020309060101050800FF060000000802020F031620020309060101060800FF060001426D02020F031620020309060101070800FF06000019FC02020F031620020309060101080800FF0600018C7B02020F03162001010204020509060101010801FF0600009B7C02020F03161E0000020509060101020801FF06004650E702020F03161E0000020509060101030801FF060001427602020F0316200000020509060101040801FF060001A67802020F0316200000010102020906000062853DFF0105020312001202020F03161C090C07E00B03FF102800FF8000FF020312001102020F03161C090C07E00B03FF101E00FF8000FF020312000F02020F03161C090C07E00B17FF110A00FF8000FF020312000E02020F03161C090C07E00B0DFF111E00FF8000FF020312000D02020F03161C090C07E00B1DFF110000FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F0016040202113E1114090C07E00B0102020000FF8000FF01010206020309060101020800FF060045885802020F03161E020309060101010800FF060000996F02020F03161E020309060101050800FF060000000802020F031620020309060101060800FF0600013F6402020F031620020309060101070800FF06000019A402020F031620020309060101080800FF06000185E302020F03162001010204020509060101010801FF060000996F02020F03161E0000020509060101020801FF060045885802020F03161E0000020509060101030801FF0600013F6D02020F0316200000020509060101040801FF0600019F8802020F0316200000010102020906000062853DFF0105020312001102020F03161C090C07E00A0AFF111E00FF8000FF020312000F02020F03161C090C07E00A0EFF112800FF8000FF020312000E02020F03161C090C07E00A0BFF112800FF8000FF020312000D02020F03161C090C07E00A03FF112800FF8000FF020312000C02020F03161C090C07E00A1EFF112800FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001E02020F0016040202113D1114090C07E00A0106020000FF8000FF01010206020309060101020800FF0600449E4302020F03161E020309060101010800FF060000977202020F03161E020309060101050800FF060000000802020F031620020309060101060800FF0600013B5A02020F031620020309060101070800FF060000194B02020F031620020309060101080800FF0600017FDA02020F03162001010204020509060101010801FF060000977202020F03161E0000020509060101020801FF0600449E4302020F03161E0000020509060101030801FF0600013B6302020F0316200000020509060101040801FF060001992602020F0316200000010102020906000062853DFF0105020312000F02020F03161C090C07E00916FF113200FF8000FF020312000E02020F03161C090C07E00917FF113200FF8000FF020312000E02020F03161C090C07E00913FF113200FF8000FF020312000D02020F03161C090C07E0090BFF120000FF8000FF020312000D02020F03161C090C07E00908FF120000FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F0016040202113C1114090C07E0090104020000FF8000FF01010206020309060101020800FF0600438E2502020F03161E020309060101010800FF060000956202020F03161E020309060101050800FF060000000802020F031620020309060101060800FF060001364802020F031620020309060101070800FF06000018E502020F031620020309060101080800FF06000179B702020F03162001010204020509060101010801FF060000956202020F03161E0000020509060101020801FF0600438E2502020F03161E0000020509060101030801FF060001365102020F0316200000020509060101040801FF060001929C02020F0316200000010102020906000062853DFF0105020312000E02020F03161C090C07E0081EFF120A00FF8000FF020312000E02020F03161C090C07E00816FF121400FF8000FF020312000D02020F03161C090C07E00810FF121400FF8000FF020312000D02020F03161C090C07E00807FF121E00FF8000FF020312000C02020F03161C090C07E00811FF121400FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F0016040202113B1114090C07E0080101020000FF8000FF01010206020309060101020800FF0600426AF602020F03161E020309060101010800FF060000935102020F03161E020309060101050800FF060000000702020F031620020309060101060800FF06000130EA02020F031620020309060101070800FF060000189202020F031620020309060101080800FF06000173C502020F03162001010204020509060101010801FF060000935102020F03161E0000020509060101020801FF0600426AF602020F03161E0000020509060101030801FF06000130F202020F0316200000020509060101040801FF0600018C5802020F0316200000010102020906000062853DFF0105020312000F02020F03161C090C07E0071FFF121400FF8000FF020312000F02020F03161C090C07E0071CFF121E00FF8000FF020312000D02020F03161C090C07E0071DFF121E00FF8000FF020312000D02020F03161C090C07E00704FF121E00FF8000FF020312000C02020F03161C090C07E00719FF121E00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001E02020F0016040202113A1114090C07E0070105020000FF8000FF01010206020309060101020800FF0600412AEB02020F03161E020309060101010800FF060000910702020F03161E020309060101050800FF060000000702020F031620020309060101060800FF0600012ACE02020F031620020309060101070800FF060000185302020F031620020309060101080800FF0600016DE802020F03162001010204020509060101010801FF060000910702020F03161E0000020509060101020801FF0600412AEB02020F03161E0000020509060101030801FF0600012AD702020F0316200000020509060101040801FF060001863B02020F0316200000010102020906000062853DFF0105020312001302020F03161C090C07E0061AFF121400FF8000FF020312000E02020F03161C090C07E0060FFF121E00FF8000FF020312000E02020F03161C090C07E0060AFF121E00FF8000FF020312000E02020F03161C090C07E00606FF121400FF8000FF020312000D02020F03161C090C07E0060BFF121E00FF8000FF008201AA0205020209060000600100FF0A083533313230363338020509060100628601FF12001F02020F001604020211391114090C07E0060103020000FF8000FF01010206020309060101020800FF060040016102020F03161E020309060101010800FF0600008EC302020F03161E020309060101050800FF060000000702020F031620020309060101060800FF060001253E02020F031620020309060101070800FF060000183202020F031620020309060101080800FF060001683A02020F03162001010204020509060101010801FF0600008EC302020F03161E0000020509060101020801FF060040016102020F03161E0000020509060101030801FF060001254602020F0316200000020509060101040801FF060001806D02020F0316200000010102020906000062853DFF0105020312001102020F03161C090C07E0050EFF120000FF8000FF020312001102020F03161C090C07E00502FF120A00FF8000FF020312001002020F03161C090C07E0050BFF120A00FF8000FF020312000E02020F03161C090C07E00506FF121400FF8000FF020312000D02020F03161C090C07E0051FFF120A00FF8000FF";

const char profile_example[] = "008205F40182008B020102080202090C07C80101FF001D0FFF8000FF0406800000000500000000058E20001F0500000000050000000002010208000000000500000000058E2000200500000000050000"
"000002010208000000000500000000058E2000210500000000050000000002010208000000000500000000058E2000220500000000050000000002010208000000000500000000058E20002305000000"
"00050000000002010208000000000500000000058E2000240500000000050000000002010208000000000500000000058E2000250500000000050000000002010208000000000500000000058E200026"
"0500000000050000000002010208000000000500000000058E2000270500000000050000000002010208000000000500000000058E200028050000000005000000000201020800000000050000000005"
"8E2000290500000000050000000002010208000000000500000000058E20002A0500000000050000000002010208000000000500000000058E20002B0500000000050000000002010208000000000500"
"000000058E20002C0500000000050000000002010208000000000500000000058E20002D0500000000050000000002010208000000000500000000058E20002E05000000000500000000020102080000"
"00000500000000058E20002F0500000000050000000002010208000000000500000000058E2000300500000000050000000002010208000000000500000000058E200031050000000005000000000201"
"0208000000000500000000058E2000320500000000050000000002010208000000000500000000058E2000330500000000050000000002010208000000000500000000058E2000340500000000050000"
"000002010208000000000500000000058E2000350500000000050000000002010208000000000500000000058E2000360500000000050000000002010208000000000500000000058E20003705000000"
"00050000000002010208000000000500000000058E2000380500000000050000000002010208000000000500000000058E2000390500000000050000000002010208000000000500000000058E20003A"
"0500000000050000000002010208000000000500000000058E20003B0500000000050000000002010208000000000500000000058E210000050000000005000000000201020800000000050000000005"
"8E2100010500000000050000000002010208000000000500000000058E2100020500000000050000000002010208000000000500000000058E2100030500000000050000000002010208000000000500"
"000000058E2100040500000000050000000002010208000000000500000000058E2100050500000000050000000002010208000000000500000000058E21000605000000000500000000020102080000"
"00000500000000058E2100070500000000050000000002010208000000000500000000058E2100080500000000050000000002010208000000000500000000058E210009050000000005000000000201"
"0208000000000500000000058E21000A0500000000050000000002010208000000000500000000058E21000B0500000000050000000002010208000000000500000000058E21000C0500000000050000"
"000002010208000000000500000000058E21000D0500000000050000000002010208000000000500000000058E21000E0500000000050000000002010208000000000500000000050000000005000000"
"000500000000020102080202090C07E10B1CFF091938FF8000FF040680000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000"
"0201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005"
"0000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500"
"0000000500000000008205CC0201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000"
"0005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000"
"0500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208"
"0000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000"
"0201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005"
"0000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500"
"0000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000"
"0000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000"
"0005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000"
"0500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208"
"0000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000"
"0201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005"
"0000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500"
"0000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000"
"0000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000"
"0005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000"
"0500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208"
"0000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000"
"02010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000082039C0201020800000000050000000005000000000500"
"0000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000"
"0000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000"
"0005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000"
"0500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208"
"0000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000"
"0201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005"
"0000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500"
"0000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000"
"0000050000000005000000000201020800000000050000000005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000"
"0005000000000500000000050000000002010208000000000500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000"
"0500000000050000000005000000000500000000020102080000000005000000000500000000050000000005000000000201020800000000050000000005000000000500000000050000000002010208"
"000000000500000000050000000005000000000500000000";

int profile_size = sizeof(profile_example);

static AxdrPrinter gPrinter;

static void AxdrData(uint8_t type, uint32_t size, uint8_t *data)
{
    gPrinter.Append(type, size, data);
}


void TestBigBlockProfile()
{
    // transform the hexadecimal string into an array of integers
    size_t packet_size = profile_size/2U;
    uint8_t *packet = (uint8_t *) malloc(packet_size);

    if (packet != NULL)
    {
        int ret;
        uint8_t *packet_ptr = packet;

        hex2bin(profile_example, (char *)packet, profile_size);

        csm_array array;
        csm_array_init(&array, packet, packet_size, packet_size, 0);
        uint32_t size = 0U;
        csm_axdr_decode_block(&array, &size);

        printf("Profile size: %d\r\n", size); // must be 500

    //    root.Clear();

        gPrinter.Start();
        ret = csm_axdr_decode_tags(&array, AxdrData);
        gPrinter.End();

        REQUIRE(ret == TRUE);

        std::cout << gPrinter.Get() << std::endl;

        free(packet);
    }
    else
    {
       printf("Cannot allocate memory!\r\n");
    }

}


TEST_CASE( "COSEM_READ", "[Read by block]" )
{
    puts("\r\n--------------------------  COSEM TEST READ 1  --------------------------\r\n");
    TestBigBlockProfile();
}


